<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin</title>
    <script defer src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  </head>
  <body>
    <noscript>Нужен JavaScript для входа в админку.</noscript>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        if (window.netlifyIdentity) {
          // Открываем окно логина автоматически, если не залогинен
          window.netlifyIdentity.on('init', (user) => {
            if (!user) window.netlifyIdentity.open('login');
          });
          // После логина перезагружаем страницу, CMS поднимется
          window.netlifyIdentity.on('login', () => window.location.reload());
          // Если вдруг виджет не инициализировался — откроем через 1с
          setTimeout(() => window.netlifyIdentity && window.netlifyIdentity.open('login'), 1000);
        }
      });
    </script>
  </body>
</html>
